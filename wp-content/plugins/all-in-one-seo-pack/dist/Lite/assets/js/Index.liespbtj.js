import{c as S,R as F,a as B}from"./constants.fxxegv78.js";import{s as x,e as H,n as M,b as ue,u as j,D as K}from"./index.nsvc8vqf.js";import{b as Z,c as X,e as $,d as Y,C as Q,_ as ee}from"./Caret.hnvbzqgq.js";import{u as ne}from"./JsonValues.g6ep3o3z.js";import"./translations.lf9cwm9a.js";import{_ as i,a as L}from"./default-i18n.hohxoesu.js";import{B as G,S as te,b as re}from"./index.h076fivy.js";import{C as ce}from"./ProBadge.ab6jhp8x.js";import{S as de}from"./External.h5te4wqm.js";import{v as c,o as a,c as y,a as o,F as V,J as N,k as m,l as _,x as T,t as U,b as g,E as se,C as p,G as q,m as he,$ as ge}from"./runtime-dom.esm-bundler.h3clfjuw.js";import{_ as I}from"./_plugin-vue_export-helper.oebm7xum.js";import{e as me}from"./escapeRegExp.cd9ew2v1.js";import{S as le}from"./Exclamation.f0pmbpi9.js";import{B as pe}from"./Checkbox.fww0datn.js";import{S as fe}from"./Gear.dx9icaxx.js";import{T as ie}from"./Slide.dop8j51m.js";import{a as _e}from"./date.ecds9xx3.js";import{B as ye}from"./DatePicker.odhs29tp.js";import{C as ve}from"./Tooltip.jx4casvt.js";import{S as Re}from"./Plus.e1tf1dpc.js";const O="all-in-one-seo-pack",ae=()=>({redirectHasUnPublishedPost:t=>t.post_id&&t.postStatus!=="publish",validateRedirect:t=>{const d=[];if(!t.url.url)return d;if(t.url.regex)try{new RegExp(t.url.url)}catch{return d.push(i("The regex syntax is invalid.",O)),d}if(!t.url.regex&&!x(t.url.url))return d.push(i("Your URL is invalid.",O)),d;if(t.url.url.substr(0,4)==="http"&&d.push(i("Please enter a valid relative source URL.",O)),t.url.url.match(/%[a-zA-Z]+%/)&&d.push(i("Permalinks are not currently supported.",O)),(t.url.url==="/(.*)"||t.url.url==="^/(.*)")&&d.push(i("This redirect is supported using the Relocate Site feature under Full Site Redirect tab.",O)),t.url.url&&t.url.url.length&&t.targetUrl&&t.targetUrl.length){let l=t.url.ignoreSlash?H.unTrailingSlashIt(t.url.url):t.url.url,n=t.url.ignoreSlash?H.unTrailingSlashIt(t.targetUrl):t.targetUrl;l=t.url.ignoreCase?l.toLowerCase():l,n=t.url.ignoreCase?n.toLowerCase():n,(l===n||t.url.regex&&n.match(l))&&d.push(i("Your source is the same as a target and this will create a loop.",O))}const s=M();if(0<(s==null?void 0:s.protectedPaths.length)){const l=s.protectedPaths.map(n=>n.replace(/\/$/,""));t.url.url.match(new RegExp("^("+l.join("|")+")"))&&d.push(i("Your source is a protected path and cannot be redirected.",O))}return d}}),J="all-in-one-seo-pack",Ue={emits:["set-url"],components:{CoreProBadge:ce,SvgExternal:de},props:{results:{type:Array,required:!0},url:String},data(){return{strings:{DRAFT:i("DRAFT",J),PENDING:i("PENDING",J),FUTURE:i("FUTURE",J)}}},methods:{getOptionTitle(e){e=x(e);const r=x(this.url),t=new RegExp(`(${me(r)})`,"gi");return e.replace(t,'<span class="search-term">$1</span>')},getStatusLabel(e){switch(e.toLowerCase()){case"draft":return this.strings.DRAFT;case"future":return this.strings.FUTURE;case"pending":return this.strings.PENDING}}}},be={class:"aioseo-add-redirection-url-results"},Se=["onClick"],Te={class:"option"},we={class:"option-title"},ke=["innerHTML"],De={class:"option-details"},Ce=["href"];function Ee(e,r,t,d,s,l){const n=c("core-pro-badge"),w=c("svg-external");return a(),y("div",be,[o("ul",null,[(a(!0),y(V,null,N(t.results,(b,P)=>(a(),y("li",{key:P,onClick:A=>e.$emit("set-url",b.link)},[o("span",null,[o("div",Te,[o("div",we,[o("div",{innerHTML:l.getOptionTitle(b.label)},null,8,ke),b.status!=="publish"?(a(),m(n,{key:0},{default:_(()=>[T(U(l.getStatusLabel(b.status)),1)]),_:2},1024)):g("",!0)]),o("div",De,[o("span",null,U(b.link),1)])]),o("a",{class:"option-permalink",href:b.link,target:"_blank",onClick:se(()=>{},["stop"])},[p(w)],8,Ce)])],8,Se))),128))])])}const oe=I(Ue,[["render",Ee]]),Le={setup(){return{postEditorStore:ue(),redirectsStore:M(),rootStore:j()}},components:{BaseInput:G,CoreAddRedirectionUrlResults:oe,CoreLoader:Z,SvgCircleCheck:X,SvgCircleClose:$,SvgCircleExclamation:le},props:{url:String,errors:Array,warnings:Array},data(){return{showResults:!1,isLoading:!1,value:null,results:[]}},watch:{value(){this.value&&(this.value=this.value.replace(/(https?:\/)(\/)+|(\/)+/g,"$1$2$3"),this.value.startsWith("/")&&(this.value=this.value.replace(/\s+/g,"")))},url:{immediate:!0,handler(){this.value=this.url}}},methods:{onBlur(){setTimeout(()=>{this.$emit("update:modelValue",this.value)},150)},searchChange(){if(!this.value){this.isLoading=!1,this.showResults=!1,this.results=[];return}if(this.value.startsWith("/")||this.value.startsWith("http:")||this.value.startsWith("https:")){this.isLoading=!1,this.showResults=!1,this.results=[];return}this.isLoading=!0,Y(()=>{if(!this.value){this.isLoading=!1,this.showResults=!1,this.results=[];return}this.showResults=!0,this.ajaxSearch(this.value).then(()=>this.isLoading=!1)},500)},ajaxSearch(e){return this.redirectsStore.getPosts({query:e,postId:this.postEditorStore.currentPost.id}).then(r=>{this.results=r.body.objects})},setUrl(e){this.showResults=!1,this.value=e.replace(this.rootStore.aioseo.urls.home,"",e),this.$emit("update:modelValue",this.value)},documentClick(e){if(!this.showResults)return;const r=e&&e.target?e.target:null,t=this.$refs["redirect-target-url"];t&&t!==r&&!t.contains(r)&&(this.showResults=!1)}},mounted(){document.addEventListener("click",this.documentClick);const e=document.querySelector("#aioseo-modal-portal .modal-wrapper");e&&e.addEventListener("click",this.documentClick);const r=document.querySelector("#main-settings-cont");r&&r.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick);const e=document.querySelector("#aioseo-modal-portal .modal-wrapper");e&&e.removeEventListener("click",this.documentClick);const r=document.querySelector("#main-settings-cont");r&&r.removeEventListener("click",this.documentClick)}},Ve={class:"aioseo-add-redirection-target-url",ref:"redirect-target-url"},Pe={class:"append-icon"};function Ae(e,r,t,d,s,l){const n=c("svg-circle-close"),w=c("svg-circle-check"),b=c("svg-circle-exclamation"),P=c("core-loader"),A=c("base-input"),E=c("core-add-redirection-url-results");return a(),y("div",Ve,[p(A,{modelValue:s.value,"onUpdate:modelValue":[r[0]||(r[0]=D=>s.value=D),r[2]||(r[2]=D=>e.$emit("update:modelValue",s.value))],onKeyup:l.searchChange,onFocus:r[1]||(r[1]=D=>s.showResults=!0),onBlur:r[3]||(r[3]=D=>e.$emit("blur",s.value)),size:"medium",placeholder:"/target-page/",class:q({"aioseo-error":t.errors.length,"aioseo-active":!t.errors.length&&!t.warnings.length&&t.url,"aioseo-warning":t.warnings.length})},{"append-icon":_(()=>[o("div",Pe,[s.isLoading?g("",!0):(a(),y(V,{key:0},[t.errors.length?(a(),m(n,{key:0})):g("",!0),!t.errors.length&&!t.warnings.length&&t.url?(a(),m(w,{key:1})):g("",!0),t.warnings.length?(a(),m(b,{key:2})):g("",!0)],64)),s.isLoading?(a(),m(P,{key:1,dark:""})):g("",!0)])]),_:1},8,["modelValue","onKeyup","class"]),s.showResults&&s.results.length?(a(),m(E,{key:0,results:s.results,url:s.value,onSetUrl:l.setUrl},null,8,["results","url","onSetUrl"])):g("",!0)],512)}const xe=I(Le,[["render",Ae]]),Oe=function(e,r){if(typeof e!="string")return e;const t=new RegExp("^"+r.replace(/\/$/,""),"i");return e.replace(t,"")},C="all-in-one-seo-pack",Ne={emits:["updated-url","remove-url","updated-option"],setup(){const{validateRedirect:e}=ae();return{redirectsStore:M(),rootStore:j(),validateRedirect:e}},components:{BaseCheckbox:pe,BaseInput:G,CoreAddRedirectionUrlResults:oe,CoreAlert:Q,CoreLoader:Z,SvgCircleCheck:X,SvgCircleClose:$,SvgCircleExclamation:le,SvgGear:fe,SvgTrash:te,TransitionSlide:ie},props:{url:{type:Object,default(){return{id:null,url:null,regex:!1,ignoreSlash:!0,ignoreCase:!0,errors:[],warnings:[]}}},allowDelete:Boolean,targetUrl:String,log404:Boolean,disableSource:Boolean},data(){return{showResults:!1,isLoading:!1,showOptions:!1,strings:{ignoreSlash:i("Ignore Slash",C),ignoreCase:i("Ignore Case",C),regex:i("Regex",C)},results:[]}},watch:{targetUrl(){this.updateSourceUrl(this.url.url)}},computed:{maybeRegex(){return this.url.url.match(/[*\\()[\]^$]/)!==null||this.url.url.indexOf(".?")!==-1},iffyUrl(){if(!this.url.url||this.disableSource)return[];const e=[];return this.url.url.substr(0,4)!=="http"&&this.url.url.substr(0,1)!=="/"&&0<this.url.url.length&&!this.url.regex&&e.push(L(i("The source URL should probably start with a %1$s",C),"<code>/</code>")),this.url.url.indexOf("#")!==-1&&e.push(i("Anchor values are not sent to the server and cannot be redirected.",C)),!this.log404&&this.maybeRegex&&!this.url.regex&&e.push(L(i("Remember to enable the %1$s option if this is a regular expression.",C),"<code>Regex</code>")),this.url.regex&&(this.url.url.indexOf("^")===-1&&this.url.url.indexOf("$")===-1&&e.push(L(i("To prevent a greedy regular expression you can use %1$s to anchor it to the start of the URL. For example: %2$s",C),"<code>^/</code>","<code>^/"+x(this.url.url.replace(/^\//,""))+"</code>")),0<this.url.url.indexOf("^")&&e.push(L(i("The caret %1$s should be at the start. For example: %2$s",C),"<code>^/</code>","<code>^/"+x(this.url.url.replace("^","").replace(/^\//,""))+"</code>")),this.url.url.indexOf("^")===0&&this.url.url.indexOf("^/")===-1&&e.push(L(i("The source URL should probably start with a %1$s",C),"<code>^/</code>")),this.url.url.length-1!==this.url.url.indexOf("$")&&this.url.url.indexOf("$")!==-1&&e.push(L(i("The dollar symbol %1$s should be at the end. For example: %2$s",C),"<code>$</code>","<code>"+x(this.url.url.replace(/\$/g,""))+"$</code>"))),this.url.url.match(/(\.html|\.htm|\.php|\.pdf|\.jpg)$/)!==null&&e.push(i("Some servers may be configured to serve file resources directly, preventing a redirect occurring.",C)),e},urlOptionsActive(){return this.url.regex||this.showOptions}},methods:{updateSourceUrl(e){!this.disableSource&&e&&(e&&(e=e.replace(/(https?:\/)(\/)+|(\/)+/g,"$1$2$3")),!this.url.regex&&e.startsWith("/")&&(e=e.replace(/\s+/g,"")),e=Oe(e,this.rootStore.aioseo.urls.home)),this.url.url=e,this.url.errors=this.validateRedirect(this),this.url.warnings=this.iffyUrl,this.$emit("updated-url",this.url)},updateOption(e,r){this.url[e]=r,this.updateSourceUrl(this.url.url),this.$emit("updated-option",this.url)},searchChange(){if(!this.url.url||this.url.regex){this.isLoading=!1,this.showResults=!1,this.results=[];return}if(this.url.url.startsWith("/")||this.url.url.startsWith("^")||this.url.url.startsWith("http:")||this.url.url.startsWith("https:")){this.isLoading=!1,this.showResults=!1,this.results=[];return}this.isLoading=!0,Y(()=>{if(!this.url.url){this.isLoading=!1,this.showResults=!1,this.results=[];return}this.showResults=!0,this.ajaxSearch(this.url.url).then(()=>this.isLoading=!1)},500)},ajaxSearch(e){return this.redirectsStore.getPosts({query:e}).then(r=>{this.results=r.body.objects})},setUrl(e){this.showResults=!1,this.updateOption("url",e.replace(this.rootStore.aioseo.urls.home,"",e))},documentClick(e){if(!this.showResults)return;const r=e&&e.target?e.target:null,t=this.$refs["redirect-source-url"];t&&t!==r&&!t.contains(r)&&(this.showResults=!1)}},mounted(){this.url.showOptions&&(this.showOptions=!0,this.updateSourceUrl(this.url.url)),document.addEventListener("click",this.documentClick)},beforeUnmount(){document.removeEventListener("click",this.documentClick)}},qe={class:"aioseo-redirect-source-url",ref:"redirect-source-url"},Be={class:"append-icon"};function He(e,r,t,d,s,l){const n=c("svg-circle-close"),w=c("svg-circle-check"),b=c("svg-circle-exclamation"),P=c("svg-gear"),A=c("svg-trash"),E=c("core-loader"),D=c("base-input"),z=c("core-add-redirection-url-results"),R=c("base-checkbox"),k=c("transition-slide"),u=c("core-alert");return a(),y("div",qe,[p(D,{modelValue:t.url.url,"onUpdate:modelValue":r[2]||(r[2]=h=>l.updateSourceUrl(h)),onKeyup:l.searchChange,onFocus:r[3]||(r[3]=h=>s.showResults=!0),disabled:t.log404||t.disableSource,size:"medium",placeholder:"/source-page/",class:q({"aioseo-error":t.url.errors.length,"aioseo-active":!t.url.errors.length&&!t.url.warnings.length&&t.url.url,"aioseo-warning":t.url.warnings.length})},{"append-icon":_(()=>[o("div",Be,[s.isLoading?g("",!0):(a(),y(V,{key:0},[t.url.errors.length?(a(),m(n,{key:0})):g("",!0),!t.url.errors.length&&!t.url.warnings.length&&t.url.url?(a(),m(w,{key:1})):g("",!0),t.url.warnings.length?(a(),m(b,{key:2})):g("",!0),p(P,{class:q({active:l.urlOptionsActive}),onClick:r[0]||(r[0]=h=>s.showOptions=!s.showOptions)},null,8,["class"]),t.allowDelete?(a(),m(A,{key:3,onClick:r[1]||(r[1]=h=>e.$emit("remove-url"))})):g("",!0)],64)),s.isLoading?(a(),m(E,{key:1,dark:""})):g("",!0)])]),_:1},8,["modelValue","onKeyup","disabled","class"]),!t.url.regex&&s.showResults&&s.results.length?(a(),m(z,{key:0,results:s.results,url:t.url.url,onSetUrl:l.setUrl},null,8,["results","url","onSetUrl"])):g("",!0),t.log404?g("",!0):he(e.$slots,"source-url-description",{key:1}),p(k,{active:s.showOptions,class:"source-url-options"},{default:_(()=>[p(R,{size:"medium",modelValue:t.url.ignoreSlash,"onUpdate:modelValue":r[4]||(r[4]=h=>l.updateOption("ignoreSlash",h))},{default:_(()=>[T(U(s.strings.ignoreSlash),1)]),_:1},8,["modelValue"]),p(R,{size:"medium",modelValue:t.url.ignoreCase,"onUpdate:modelValue":r[5]||(r[5]=h=>l.updateOption("ignoreCase",h))},{default:_(()=>[T(U(s.strings.ignoreCase),1)]),_:1},8,["modelValue"]),!t.log404&&!t.disableSource?(a(),m(R,{key:0,size:"medium",modelValue:t.url.regex,"onUpdate:modelValue":r[6]||(r[6]=h=>l.updateOption("regex",h))},{default:_(()=>[T(U(s.strings.regex),1)]),_:1},8,["modelValue"])):g("",!0)]),_:1},8,["active"]),p(k,{active:!!t.url.errors.length},{default:_(()=>[(a(!0),y(V,null,N(t.url.errors,(h,W)=>(a(),m(u,{key:W,class:"source-url-error",type:"red",size:"small",innerHTML:h},null,8,["innerHTML"]))),128))]),_:1},8,["active"]),p(k,{active:!!t.url.warnings.length},{default:_(()=>[(a(!0),y(V,null,N(t.url.warnings,(h,W)=>(a(),m(u,{key:W,class:"source-url-warning",type:"yellow",size:"small",innerHTML:h},null,8,["innerHTML"]))),128))]),_:1},8,["active"])],512)}const Ie=I(Ne,[["render",He]]),v="all-in-one-seo-pack",ze={type:null,key:null,value:null,regex:null},Fe={emits:["redirects-custom-rule-error"],setup(){return{dateStringToLocalJs:_e,rootStore:j()}},components:{BaseButton:ee,BaseDatePicker:ye,BaseInput:G,BaseSelect:re,CoreAlert:Q,CoreTooltip:ve,SvgCirclePlus:Re,SvgTrash:te},props:{editCustomRules:Array},data(){return{DateTime:K,strings:{customRules:i("Custom Rules",v),selectMatchRule:i("Select Rule",v),delete:i("Delete",v),add:i("Add Custom Rule",v),regex:i("Regex",v),selectAValue:i("Select a Value or Add a New One",v),key:i("Key",v),value:i("Value",v),startDate:i("Start Date",v),endDate:i("End Date",v)},customRules:[],rulesErrors:[],types:[{label:S.schedule,value:"schedule",taggable:!1,regex:!1,dateRange:!0},{label:S.login,value:"login",placeholder:i("Select Status",v),singleRule:!0,options:[{label:S.loggedin,value:"loggedin"},{label:S.loggedout,value:"loggedout"}]},{label:S.role,value:"role",multiple:!0,placeholder:i("Select Roles",v),options:Object.entries(this.rootStore.aioseo.user.roles).map(e=>({label:e[1],value:e[0]}))},{label:S.referrer,value:"referrer",regex:!0,singleRule:!0},{label:S.agent,value:"agent",regex:!0,taggable:!0,multiple:!0,options:[{label:S.mobile,value:"mobile",docLink:H.getDocLink(i("Learn more",v),"redirectCustomRulesUserAgent",!0)},{label:S.feeds,value:"feeds",docLink:H.getDocLink(i("Learn more",v),"redirectCustomRulesUserAgent",!0)},{label:S.libraries,value:"libraries",docLink:H.getDocLink(i("Learn more",v),"redirectCustomRulesUserAgent",!0)}]},{label:S.cookie,value:"cookie",keyValuePair:!0,regex:!0},{label:S.ip,value:"ip",placeholder:i("Enter an IP Address",v),taggable:!0,regex:!0,singleRule:!0},{label:S.server,value:"server",placeholder:i("Enter the Server Name",v),regex:!0,singleRule:!0},{label:S.header,value:"header",keyValuePair:!0,regex:!0},{label:S.wp_filter,value:"wp_filter",placeholder:i("Enter a WordPress Filter Name",v),taggable:!0},{label:S.locale,value:"locale",taggable:!0,regex:!0,placeholder:i("Enter a Locale Code, e.g.: en_GB, es_ES",v),singleRule:!0}]}},watch:{customRules:{deep:!0,handler(){this.validationError()}}},computed:{hasCustomRules(){return 0<this.customRules.length},filteredTypes(){return this.types.map(e=>(e.$isDisabled=!1,e.singleRule&&this.customRules.find(r=>e.value===r.type)&&(e.$isDisabled=!0),e))}},methods:{isDisabledStartDate(e){const r=new Date;return r.setHours(0,0,0,0),e<r},isDisabledEndDate(e,r){const t=this.getRuleValue("scheduleStart",r);return t?(e.setHours(23,59,59,0),this.dateStringToLocalJs(t)>e):this.isDisabledStartDate(e)},removeRule(e){this.customRules.splice(e,1),this.hasCustomRules||this.addRule(null)},addRule(e,r=!1){e||(e=JSON.parse(JSON.stringify(ze))),(!r||r&&this.customRules.filter(t=>t===e).length===0)&&this.customRules.push(e)},updateRule(e,r,t){const d=this.customRules[t];r=typeof r.value<"u"?r.value:r,r=typeof r=="object"&&r.length?r.map(s=>s.value):r,d[e]=r,e==="type"&&(d.value=""),this.customRules[t]=d},getRuleValue(e,r,t=!1){if(!this.customRules[r])return;let s=this.customRules[r][e],l=null;if(t)return s;switch(e){case"type":s=this.types.find(n=>s===n.value);break;case"value":l=this.getType(r,"options"),l&&(typeof s=="object"?s=s.map(n=>l.find(w=>n===w.value)||n).filter(n=>!!n):s=l.find(n=>s===n.value)||s),this.getType(r,"taggable")&&(s=typeof s=="object"?s.map(n=>typeof n.label>"u"?{label:n,value:n}:n):[]);break}return s},getType(e,r){const t=this.getRuleValue("type",e);return r?t&&typeof t[r]<"u"?t[r]:!1:t},validationError(){let e=!1,r=null,t=null;this.customRules.forEach((d,s)=>{switch(this.rulesErrors[s]=null,d.type){case"schedule":r=this.getRuleValue("scheduleStart",s),t=this.getRuleValue("scheduleEnd",s),r&&t&&(r>t&&(this.rulesErrors[s]=i("The Start Date must be lower than the End Date.",v),e=!0),r===t&&(this.rulesErrors[s]=i("Start Date and End Date must be different.",v),e=!0));break}}),this.$emit("redirects-custom-rule-error",e)},updateDate(e,r,t){const d=e!==null?K.fromJSDate(e).toUTC().toString():"";this.updateRule(r,d,t)}},mounted(){this.editCustomRules&&(this.customRules=this.editCustomRules),this.hasCustomRules||this.addRule(null)}},Me={class:"custom-rules"},We={class:"redirects-options-table",cellspacing:"0",cellpadding:"0","aria-label":"Custom Rules"},Je={colspan:"2"},je={class:"rule-settings"},Ye={class:"rule-row"},Qe={class:"rule-option"},Ge={key:3,class:"date-range"},Ke={key:0,class:"rule-error"},Ze={class:"actions"},Xe={colspan:"2"};function $e(e,r,t,d,s,l){const n=c("base-select"),w=c("base-input"),b=c("base-date-picker"),P=c("base-toggle"),A=c("core-alert"),E=c("svg-trash"),D=c("core-tooltip"),z=c("svg-circle-plus"),R=c("base-button");return a(),y("div",Me,[o("table",We,[o("thead",null,[o("tr",null,[o("td",Je,U(s.strings.customRules),1)])]),o("tbody",null,[(a(!0),y(V,null,N(s.customRules,(k,u)=>(a(),y("tr",{class:q(["rule",{even:u%2===0}]),key:u},[o("td",je,[o("div",Ye,[o("div",Qe,[p(n,{options:l.filteredTypes,size:"medium",placeholder:s.strings.selectMatchRule,modelValue:l.getRuleValue("type",u),"onUpdate:modelValue":h=>l.updateRule("type",h,u)},null,8,["options","placeholder","modelValue","onUpdate:modelValue"]),l.getType(u,"options")||l.getType(u,"taggable")?(a(),m(n,{key:0,options:l.getType(u,"options")||[],size:"medium",modelValue:l.getRuleValue("value",u),"onUpdate:modelValue":h=>l.updateRule("value",h,u),multiple:l.getType(u,"multiple")||l.getType(u,"taggable"),taggable:l.getType(u,"taggable"),placeholder:l.getType(u,"placeholder")||s.strings.selectAValue},null,8,["options","modelValue","onUpdate:modelValue","multiple","taggable","placeholder"])):g("",!0),l.getType(u,"keyValuePair")?(a(),m(w,{key:1,modelValue:l.getRuleValue("key",u),"onUpdate:modelValue":h=>l.updateRule("key",h,u),size:"medium",placeholder:l.getType(u,"placeholderKey")||s.strings.key},null,8,["modelValue","onUpdate:modelValue","placeholder"])):g("",!0),!l.getType(u,"options")&&!l.getType(u,"taggable")&&!l.getType(u,"dateRange")?(a(),m(w,{key:2,modelValue:l.getRuleValue("value",u),"onUpdate:modelValue":h=>l.updateRule("value",h,u),size:"medium",placeholder:l.getType(u,"placeholder")||s.strings.value,disabled:!l.getType(u)},null,8,["modelValue","onUpdate:modelValue","placeholder","disabled"])):g("",!0),l.getType(u,"dateRange")?(a(),y("div",Ge,[p(b,{type:"datetime",size:"large",placeholder:s.strings.startDate,dateFormat:d.rootStore.aioseo.data.dateFormat+" - "+d.rootStore.aioseo.data.timeFormat,defaultValue:d.dateStringToLocalJs(l.getRuleValue("scheduleStart",u)),onChange:h=>l.updateDate(h,"scheduleStart",u),isDisabledDate:l.isDisabledStartDate},null,8,["placeholder","dateFormat","defaultValue","onChange","isDisabledDate"]),p(b,{type:"datetime",size:"large",placeholder:s.strings.endDate,dateFormat:d.rootStore.aioseo.data.dateFormat+" - "+d.rootStore.aioseo.data.timeFormat,defaultValue:d.dateStringToLocalJs(l.getRuleValue("scheduleEnd",u)),onChange:h=>l.updateDate(h,"scheduleEnd",u),isDisabledDate:h=>l.isDisabledEndDate(h,u)},null,8,["placeholder","dateFormat","defaultValue","onChange","isDisabledDate"])])):g("",!0),l.getType(u,"regex")?(a(),m(P,{key:4,modelValue:l.getRuleValue("regex",u),"onUpdate:modelValue":h=>l.updateRule("regex",h,u)},{default:_(()=>[T(U(s.strings.regex),1)]),_:2},1032,["modelValue","onUpdate:modelValue"])):g("",!0)]),s.rulesErrors[u]?(a(),y("div",Ke,[p(A,{type:"red",size:"small"},{default:_(()=>[T(U(s.rulesErrors[u]),1)]),_:2},1024)])):g("",!0)])]),o("td",Ze,[p(D,{class:"action",type:"action"},{tooltip:_(()=>[T(U(s.strings.delete),1)]),default:_(()=>[p(E,{onClick:h=>l.removeRule(u)},null,8,["onClick"])]),_:2},1024)])],2))),128))]),o("tfoot",null,[o("tr",null,[o("td",Xe,[p(R,{size:"small-table",type:"black",onClick:r[0]||(r[0]=k=>l.addRule(null))},{default:_(()=>[p(z),T(" "+U(s.strings.add),1)]),_:1})])])])])])}const et=I(Fe,[["render",$e],["__scopeId","data-v-76a3b290"]]),tt={},rt={width:"36",height:"16",viewBox:"0 0 36 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:"aioseo-right-arrow"},st=o("path",{d:"M36 8L28.4211 0.5V6.125H0V9.875H28.4211V15.5L36 8Z",fill:"currentColor"},null,-1),lt=[st];function it(e,r){return a(),y("svg",rt,lt)}const at=I(tt,[["render",it]]),f="all-in-one-seo-pack",ot={emits:["cancel","added-redirect"],setup(){const{getJsonValue:e}=ne(),{redirectHasUnPublishedPost:r}=ae();return{getJsonValue:e,redirectHasUnPublishedPost:r,redirectsStore:M()}},components:{BaseButton:ee,BaseSelect:re,CoreAddRedirectionTargetUrl:xe,CoreAddRedirectionUrl:Ie,CoreAlert:Q,CustomRules:et,SvgRightArrow:at,TransitionSlide:ie},props:{edit:Boolean,log404:Boolean,disableSource:Boolean,url:Object,urls:Array,target:String,type:Number,query:String,slash:Boolean,case:Boolean,rules:{type:Array,default(){return[]}},postId:Number,postStatus:String},data(){return{REDIRECT_TYPES:F,genericError:!1,addingRedirect:!1,targetUrlErrors:[],targetUrlWarnings:[],customRulesError:!1,strings:{redirectType:i("Redirect Type:",f),targetUrl:i("Target URL",f),targetUrlDescription:i("Enter a URL or start by typing a page or post title, slug or ID.",f),addUrl:i("Add URL",f),sourceUrlDescription:L(i("Enter a relative URL to redirect from or start by typing in page or post title, slug or ID. You can also use regex (%1$s)",f),H.getDocLink(i("what's this?",f),"redirectManagerRegex")),advancedSettings:i("Advanced Settings",f),queryParams:i("Query Parameters:",f),saveChanges:i("Save Changes",f),cancel:i("Cancel",f),genericErrorMessage:i("An error occurred while adding your redirects. Please try again later.",f),sourceUrlSetOncePublished:i("source url set once post is published",f)},sourceDisabled:!1,editing:!1,editingRedirect:{sourceUrls:[],targetUrl:null,redirectType:null,queryParam:null,customRules:[],showAdvancedSettings:!1}}},watch:{sourceUrls:{deep:!0,handler(){Y(()=>this.checkForDuplicates(),500)}}},computed:{sourceUrls:{get(){return this.editing?this.editingRedirect.sourceUrls:this.redirectsStore.addNewRedirect.sourceUrls},set(e){this.editing?this.editingRedirect.sourceUrls=e:this.redirectsStore.addNewRedirect.sourceUrls=e}},targetUrl:{get(){return this.editing?this.editingRedirect.targetUrl:this.redirectsStore.addNewRedirect.targetUrl},set(e){this.editing?this.editingRedirect.targetUrl=e:this.redirectsStore.addNewRedirect.targetUrl=e}},redirectType:{get(){return this.editing?this.editingRedirect.redirectType:this.redirectsStore.addNewRedirect.redirectType},set(e){this.editing?this.editingRedirect.redirectType=e:this.redirectsStore.addNewRedirect.redirectType=e}},queryParam:{get(){return this.editing?this.editingRedirect.queryParam:this.redirectsStore.addNewRedirect.queryParam},set(e){this.editing?this.editingRedirect.queryParam=e:this.redirectsStore.addNewRedirect.queryParam=e}},customRules:{get(){return this.editing?this.editingRedirect.customRules:this.redirectsStore.addNewRedirect.customRules},set(e){this.editing?this.editingRedirect.customRules=e:this.redirectsStore.addNewRedirect.customRules=e}},showAdvancedSettings:{get(){return this.editing?this.editingRedirect.showAdvancedSettings:this.redirectsStore.addNewRedirect.showAdvancedSettings},set(e){this.editing?this.editingRedirect.showAdvancedSettings=e:this.redirectsStore.addNewRedirect.showAdvancedSettings=e}},saveIsDisabled(){return!!this.sourceUrls.filter(e=>!e.url).length||!!this.sourceUrls.filter(e=>0<e.errors.length).length||this.redirectTypeHasTarget()&&!this.targetUrl||this.customRulesError},getRelativeAbsolute(){const e=this.targetUrl.match(/^\/([a-zA-Z0-9_\-%]*\..*)\//);return e?e[0]:null},sourceUrl(){return 1<this.sourceUrls.length?i("Source URLs",f):i("Source URL",f)},addRedirect(){return 1<this.sourceUrls.length?i("Add Redirects",f):i("Add Redirect",f)},hasTargetUrlErrors(){if(!this.targetUrl)return[];const e=[],r=x(this.targetUrl);if(!r)return e.push(i("Your target URL is not valid.",f)),e;this.targetUrl&&!this.beginsWith(this.targetUrl,"https://")&&!this.beginsWith(this.targetUrl,"http://")&&this.targetUrl.substr(0,1)!=="/"&&e.push(L(i("Your target URL should be an absolute URL like %1$s or start with a slash %2$s.",f),"<code>https://domain.com/"+r+"</code>","<code>/"+r+"</code>"));const t=this.targetUrl.match(/[|\\$]/g);return t!==null&&(this.sourceUrls.map(s=>s.regex).every(s=>s)||e.push(L(i("Your target URL contains the invalid character(s) %1$s",f),"<code>"+t+"</code>"))),e},hasTargetUrlWarnings(){if(!x(this.targetUrl))return[];const e=[];return this.getRelativeAbsolute&&e.push(L(i("Your URL appears to contain a domain inside the path: %1$s. Did you mean to use %2$s instead?",f),"<code>"+this.getRelativeAbsolute+"</code>","<code>https:/"+this.getRelativeAbsolute+"</code>")),e},getDefaultRedirectType(){let e=this.getJsonValue(this.redirectsStore.options.redirectDefaults.redirectType);return e||(e=F[0]),e},getDefaultQueryParam(){let e=this.getJsonValue(this.redirectsStore.options.redirectDefaults.queryParam);return e||(e=B[0]),e},getDefaultSlash(){return this.redirectsStore.options.redirectDefaults.ignoreSlash},getDefaultCase(){return this.redirectsStore.options.redirectDefaults.ignoreCase},getDefaultSourceUrls(){return[JSON.parse(JSON.stringify(this.getDefaultSourceUrl))]},getDefaultSourceUrl(){return{id:null,url:null,regex:!1,ignoreSlash:this.slash||this.getDefaultSlash||!1,ignoreCase:this.case||this.getDefaultCase||!1,errors:[],warnings:[]}},redirectQueryParams(){return 0<this.sourceUrls.filter(e=>e.regex).length?B.map(e=>(e.$isDisabled=!1,e.value==="exact"&&(e.$isDisabled=!0,this.queryParam.value==="exact"&&(this.queryParam=B.find(r=>!r.$isDisabled))),e)):B.map(e=>(e.$isDisabled=!1,e))},unPublishedPost(){return this.redirectHasUnPublishedPost({post_id:this.postId,postStatus:this.postStatus})}},methods:{beginsWith(e,r){return r.indexOf(e)===0||e.substr(0,r.length)===r},addUrl(){this.sourceUrls.push(JSON.parse(JSON.stringify(this.getDefaultSourceUrl)))},removeUrl(e){this.sourceUrls.splice(e,1)},addRedirects(){this.genericError=!1,this.addingRedirect=!0,this.sourceUrls.map(e=>(e.url.substr(0,4)!=="http"&&e.url.substr(0,1)!=="/"&&0<e.url.length&&!e.regex&&(e.url="/"+e.url),e)),this.redirectsStore.create({sourceUrls:this.sourceUrls,targetUrl:this.targetUrl,queryParam:this.queryParam.value,customRules:this.customRules,redirectType:this.redirectType.value,redirectTypeHasTarget:this.redirectTypeHasTarget(),group:this.log404?"404":"manual",postId:this.postId}).then(()=>{this.$emit("added-redirect"),window.aioseoBus.$emit("added-redirect"),this.reset()}).catch(e=>{this.handleError(e)})},saveChanges(){this.genericError=!1,this.addingRedirect=!0,this.sourceUrls[0].url.substr(0,4)!=="http"&&this.sourceUrls[0].url.substr(0,1)!=="/"&&0<this.sourceUrls[0].url.length&&!this.sourceUrls[0].regex&&(this.sourceUrls[0].url="/"+this.sourceUrls[0].url),this.redirectsStore.update({id:this.sourceUrls[0].id,payload:{sourceUrls:this.sourceUrls,targetUrl:this.targetUrl,queryParam:this.queryParam.value,customRules:this.customRules,redirectType:this.redirectType.value,redirectTypeHasTarget:this.redirectTypeHasTarget(),postId:this.postId}}).then(()=>{this.$emit("added-redirect"),this.reset()}).catch(e=>{console.error(e),this.handleError(e)})},handleError(e){if(e.response.status!==409||!e.response.body.failed||!e.response.body.failed.length){this.genericError=!0,this.addingRedirect=!1;return}const r=[],t=e.response.body.failed,d=i("A redirect already exists for this source URL. To make changes, edit the original instead.",f);t.forEach(s=>{const l=this.sourceUrls.findIndex(n=>n.url===s.url||s);l!==-1&&(this.sourceUrls[l].errors.find(n=>n===s.error||n===d)||this.sourceUrls[l].errors.push(s.error||d),r.push(l))});for(let s=this.sourceUrls.length-1;0<=s;s--)r.includes(s)||this.sourceUrls.splice(s,1);this.addingRedirect=!1},updateTargetUrl(e){this.targetUrl=e,this.targetUrlErrors=this.hasTargetUrlErrors,this.targetUrlWarnings=this.hasTargetUrlWarnings},reset(){if(this.showAdvancedSettings=!1,this.addingRedirect=!1,this.edit)return;const e=F.find(t=>t.value===this.type)||this.getDefaultRedirectType,r=B.find(t=>t.value===this.query)||this.getDefaultQueryParam;this.sourceUrls=[JSON.parse(JSON.stringify(this.getDefaultSourceUrl))],this.targetUrl=null,this.targetUrlErrors=[],this.targetUrlWarnings=[],this.redirectType=e||{label:"301 "+i("Moved Permanently",f),value:301},this.queryParam=r||{label:i("Ignore all parameters",f),value:"ignore"},this.customRules=[]},checkForDuplicates(){const e=[];this.sourceUrls.forEach((r,t)=>{if(!(!r.url||r.errors.length)){if(e.includes(r.url.replace(/\/$/,""))){this.sourceUrls[t].errors.push(i("This is a duplicate of a URL you are already adding. You can only add unique source URLs.",f));return}e.push(r.url.replace(/\/$/,""))}}),this.updateTargetUrl(this.targetUrl)},redirectTypeHasTarget(){return this.redirectType&&(typeof this.redirectType.noTarget>"u"||!this.redirectType.noTarget)}},mounted(){this.sourceUrls.length||(this.sourceUrls=this.getDefaultSourceUrls),this.url&&(this.editing=!0,this.sourceUrls=[{...this.getDefaultSourceUrl,...this.url}]),this.urls&&this.urls.length&&(this.editing=!0,this.sourceUrls=this.urls.map(e=>({...this.getDefaultSourceUrl,...e}))),this.sourceDisabled=this.disableSource,this.unPublishedPost&&(this.sourceUrls=this.sourceUrls.map(e=>(e.url="("+this.strings.sourceUrlSetOncePublished+")",e)),this.sourceDisabled=!0),this.target&&(this.targetUrl=this.target),this.rules&&this.rules.length!==0&&(this.customRules=this.rules),this.redirectType=F.find(e=>e.value===this.type)||this.redirectType||this.getDefaultRedirectType,this.queryParam=B.find(e=>e.value===this.query)||this.queryParam||this.getDefaultQueryParam}},ut={class:"urls"},nt={class:"source"},ct={class:"aioseo-settings-row no-border no-margin small-padding"},dt={class:"settings-name"},ht={class:"name small-margin"},gt=["innerHTML"],mt={key:0,class:"url-arrow"},pt={key:1,class:"target"},ft={class:"aioseo-settings-row no-border no-margin small-padding"},_t={class:"settings-name"},yt={class:"name small-margin"},vt={class:"url"},Rt={class:"aioseo-description"},Ut=o("div",{class:"break"},null,-1),bt={class:"source"},St=["innerHTML"],Tt=o("div",{class:"url-arrow"},null,-1),wt=o("div",{class:"target"},null,-1),kt={class:"all-settings"},Dt={class:"all-settings-content"},Ct={class:"redirect-type"},Et={class:"query-params"};function Lt(e,r,t,d,s,l){const n=c("core-alert"),w=c("core-add-redirection-url"),b=c("base-button"),P=c("svg-right-arrow"),A=c("core-add-redirection-target-url"),E=c("transition-slide"),D=c("base-select"),z=c("custom-rules");return a(),y("div",{class:q(["aioseo-add-redirection",{"edit-url":t.edit,"log-404":t.log404}])},[s.genericError?(a(),m(n,{key:0,class:"generic-error",type:"red"},{default:_(()=>[T(U(s.strings.genericErrorMessage),1)]),_:1})):g("",!0),o("div",ut,[o("div",nt,[o("div",ct,[o("div",dt,[o("div",ht,U(l.sourceUrl)+": ",1)]),(a(!0),y(V,null,N(l.sourceUrls,(R,k)=>(a(),m(w,{key:k,url:R,"allow-delete":1<l.sourceUrls.length,onRemoveUrl:u=>l.removeUrl(k),"target-url":l.targetUrl,log404:t.log404,disableSource:s.sourceDisabled},ge({_:2},[t.edit&&!s.sourceDisabled?{name:"source-url-description",fn:_(()=>[o("div",{class:"aioseo-description source-description",innerHTML:s.strings.sourceUrlDescription},null,8,gt)]),key:"0"}:void 0]),1032,["url","allow-delete","onRemoveUrl","target-url","log404","disableSource"]))),128)),!t.edit&&!t.log404&&!s.sourceDisabled?(a(),m(b,{key:0,size:"small",type:"gray",onClick:l.addUrl},{default:_(()=>[T(U(s.strings.addUrl),1)]),_:1},8,["onClick"])):g("",!0)])]),l.redirectTypeHasTarget()?(a(),y("div",mt,[p(P)])):g("",!0),l.redirectTypeHasTarget()?(a(),y("div",pt,[o("div",ft,[o("div",_t,[o("div",yt,U(s.strings.targetUrl)+": ",1)]),o("div",vt,[p(A,{url:l.targetUrl,errors:s.targetUrlErrors,warnings:s.targetUrlWarnings,"onUpdate:modelValue":l.updateTargetUrl},null,8,["url","errors","warnings","onUpdate:modelValue"]),o("div",Rt,U(s.strings.targetUrlDescription),1),p(E,{active:!!s.targetUrlErrors.length},{default:_(()=>[o("div",null,[(a(!0),y(V,null,N(s.targetUrlErrors,(R,k)=>(a(),m(n,{key:k,class:"target-url-error",type:"red",size:"small",innerHTML:R},null,8,["innerHTML"]))),128))])]),_:1},8,["active"]),p(E,{active:!!s.targetUrlWarnings.length},{default:_(()=>[o("div",null,[(a(!0),y(V,null,N(s.targetUrlWarnings,(R,k)=>(a(),m(n,{key:k,class:"target-url-warning",type:"yellow",size:"small",innerHTML:R},null,8,["innerHTML"]))),128))])]),_:1},8,["active"])])])])):g("",!0),!t.edit&&!t.log404&&!s.sourceDisabled?(a(),y(V,{key:2},[Ut,o("div",bt,[o("div",{class:"aioseo-description source-description",innerHTML:s.strings.sourceUrlDescription},null,8,St)]),Tt,wt],64)):g("",!0)]),o("div",{class:q(["settings",{advanced:l.showAdvancedSettings}])},[o("div",kt,[o("div",Dt,[o("div",Ct,[T(U(s.strings.redirectType)+" ",1),p(D,{options:s.REDIRECT_TYPES,modelValue:l.redirectType,"onUpdate:modelValue":r[0]||(r[0]=R=>l.redirectType=R),size:"medium"},null,8,["options","modelValue"])]),p(E,{class:"advanced-settings",active:l.showAdvancedSettings},{default:_(()=>[o("div",Et,[T(U(s.strings.queryParams)+" ",1),p(D,{options:l.redirectQueryParams,modelValue:l.queryParam,"onUpdate:modelValue":r[1]||(r[1]=R=>l.queryParam=R),size:"medium"},null,8,["options","modelValue"])])]),_:1},8,["active"]),l.showAdvancedSettings?g("",!0):(a(),y("a",{key:0,class:"advanced-settings-link",href:"#",onClick:r[2]||(r[2]=se(R=>l.showAdvancedSettings=!l.showAdvancedSettings,["prevent"]))},U(s.strings.advancedSettings),1))])]),p(E,{class:"advanced-settings",active:l.showAdvancedSettings},{default:_(()=>[(a(),m(z,{key:l.customRules,"edit-custom-rules":l.customRules,onRedirectsCustomRuleError:r[3]||(r[3]=R=>s.customRulesError=R)},null,8,["edit-custom-rules"]))]),_:1},8,["active"]),o("div",{class:q(["actions",{advanced:l.showAdvancedSettings}])},[p(b,{size:"medium",type:"blue",onClick:r[4]||(r[4]=R=>t.edit?l.saveChanges():l.addRedirects()),loading:s.addingRedirect,disabled:l.saveIsDisabled},{default:_(()=>[T(U(t.edit?s.strings.saveChanges:l.addRedirect),1)]),_:1},8,["loading","disabled"]),t.edit?(a(),m(b,{key:0,size:"medium",type:"gray",onClick:r[5]||(r[5]=R=>e.$emit("cancel",!0)),class:"cancel-edit-row"},{default:_(()=>[T(U(s.strings.cancel),1)]),_:1})):g("",!0)],2)],2)],2)}const Zt=I(ot,[["render",Lt]]);export{Zt as C};
